<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz</title>

  <style>
    body {
      font-family: sf pro text, -apple-system, BlinkMacSystemFont, Roboto,
        segoe ui, Helvetica, Arial, sans-serif, apple color emoji,
        segoe ui emoji, segoe ui symbol;
      font-weight: 400;
      line-height: 22.4px;
      font-size: 16px;
    }

    p,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    ul,
    ol {
      font-size: 16px;
      font-weight: 400;
    }

    ul {
      list-style: none;
      margin: 0;
      padding: 0;
      max-width: none;
    }

    code {
      background-color: #fff;
      border: 1px solid #d1d7dc;
      color: #b4690e;
      font-size: 90%;
      padding: 0.2rem 0.4rem;
    }

    .quiz-content {
      padding: 2.4rem;
      word-break: break-word;
      max-width: 86rem;
      margin: 0 auto;
    }

    .quiz-container {
      margin: 0 auto;
      max-width: 84rem;
      padding: 0;
    }

    .question {
      margin-bottom: 5rem;
    }

    .question span {
      font-size: 24px;
      font-weight: 700;
    }

    .question-prompt {
      margin-top: 0.8rem;
      font-weight: 700;
    }

    .question-answer {
      margin-top: 1.6rem;
      padding-left: 0;
      box-sizing: border-box;
    }

    .question-answer label {
      max-width: 80rem;
      position: relative;
      cursor: pointer;
      display: flex;
      min-width: 18rem;
      border: solid #1c1d1f 2px;
    }

    .question-answer div {
      padding: 0.5rem;
      width: 100%;
    }

    .question-answer div:hover {
      background-color: #f5f5f5;
    }

    /* .question-answer input {
      display: none;
    } */

    .question-answer span {
      width: 1rem;
      height: 1rem;
      margin-right: 1.6rem;
      top: 0;
      border-radius: 50%;
      display: inline-block;
      flex-shrink: 0;
      border: 0.2rem solid #1c1d1f;
      position: relative;
    }

    .selected {
      background: #1c1d1f;
      box-shadow: 0 0 0 0.4rem #fff inset;
    }

    .score {
      position: fixed;
      background-color: #b4690e;
      padding: 10px;
      color: white;
    }
  </style>
</head>

<body onload="main()">
  <div id="score" class="score">
    <span>Score: N/A of N/A</span>
  </div>
  <div id="quiz-container" class="quiz-content"></div>

  <script>
    const quizData = {"pass_percent": 70, "questions": [{"_class": "assessment", "id": 59351062, "assessment_type": "multiple-choice", "prompt": {"question": "<p>What Verilog assignment operator should you use to design sequential logic? </p>", "relatedLectureIds": ["28274120"], "feedbacks": ["Continuous assignments are used only to design combinational logic", "The blocking operator is used only for combinational logic design ", "CORRECT: Sequential logic (flip-flops and latches) can be coded only using the &lt;= non-blocking operator"], "answers": ["<p><strong>=</strong> operator in continuous assignments</p>", "<p><strong>=</strong> operator in blocking assignments</p>", "<p>&lt;= operator in non-blocking assignments</p>"]}, "correct_response": ["c"], "section": "", "question_plain": "What Verilog assignment operator should you use to design sequential logic?", "related_lectures": [{"_class": "lecture", "id": 28274120, "title": "Sequential Logic Basics", "created": "2021-08-31T13:59:08Z", "is_published": true, "asset": {"_class": "asset", "id": 36395758, "asset_type": "Video", "title": "08.01_Basics_of_Sequential_Logic.mp4", "created": "2021-09-23T10:02:19Z"}, "object_index": 127, "url": "/course/verilog-hdl-fundamentals-for-digital-design-and-verification/learn/lecture/28274120"}]}, {"_class": "assessment", "id": 59351714, "assessment_type": "multiple-choice", "prompt": {"question": "<p>What is the Verilog code for a D flip-flop with synchronous active-high reset?</p>", "relatedLectureIds": "", "feedbacks": ["The reset is active-low for this code snippet.", "For this code the reset is asynchronous active-high.", "This is correct code for a D flip-flop with synchronous active-high reset"], "answers": ["<pre class=\"prettyprint linenums\">module d_ff (input clk, input reset, input d, output reg q);\n    always @(posedge clk) begin\n        if(!reset) begin\n            q &lt;= 1'b0; // Reset value\n        end else begin\n            q &lt;= d;\n        end\n    end\nendmodule</pre>", "<pre class=\"prettyprint linenums\">module d_ff (input clk, input reset, input d, output reg q);\n    always @(posedge clk or posedge reset) begin\n        if(reset) begin\n            q &lt;= 1'b0; // Reset value\n        end else begin\n            q &lt;= d;\n        end\n    end\nendmodule</pre>", "<pre class=\"prettyprint linenums\">module d_ff (input clk, input reset, input d, output reg q);\n    always @(posedge clk) begin\n        if(reset) begin\n            q &lt;= 1'b0; // Reset value\n        end else begin\n            q &lt;= d;\n        end\n    end\nendmodule</pre>"]}, "correct_response": ["c"], "section": "", "question_plain": "What is the Verilog code for a D flip-flop with synchronous active-high reset?", "related_lectures": []}, {"_class": "assessment", "id": 59351990, "assessment_type": "multiple-choice", "prompt": {"question": "<p>What happens when an N-bit synchronous counter reaches the maximum value?</p>", "relatedLectureIds": ["28275088"], "feedbacks": ["No extra logic was mentioned to imply this behavior.", "This is the correct behavior.", "No extra logic was mentioned to imply this behavior."], "answers": ["<p>It stops incrementing and waits for reset to occur</p>", "<p>It will overflow and take the value 0.</p>", "<p>It will overflow and take the value 1.</p>"]}, "correct_response": ["b"], "section": "", "question_plain": "What happens when an N-bit synchronous counter reaches the maximum value?", "related_lectures": [{"_class": "lecture", "id": 28275088, "title": "Action Time - Nbit Counter", "created": "2021-08-31T15:20:29Z", "is_published": true, "asset": {"_class": "asset", "id": 36395912, "asset_type": "Video", "title": "08.19_Action_Time_Nbit_Counter.mp4", "created": "2021-09-23T10:11:30Z"}, "object_index": 147, "url": "/course/verilog-hdl-fundamentals-for-digital-design-and-verification/learn/lecture/28275088"}]}, {"_class": "assessment", "id": 59352230, "assessment_type": "multiple-choice", "prompt": {"question": "<p>You want to divide a 1MHz input clock frequency into a 31250 Hz output frequency. What is the required bit width for a&nbsp; Nbit frequency divider?</p>", "relatedLectureIds": ["28275278"], "feedbacks": ["This will divide the 1MHz frequency with 2**32.", "Correct: 1MHz / 32 = 31250 Hz. log2(32) = 5bit", "2**8 = 256 so you will get a division by 256"], "answers": ["<p>32bit</p>", "<p>5bit</p>", "<p>8bit</p>"]}, "correct_response": ["b"], "section": "", "question_plain": "You want to divide a 1MHz input clock frequency into a 31250 Hz output frequency. What is the required bit width for a&nbsp; Nbit frequency divider?", "related_lectures": [{"_class": "lecture", "id": 28275278, "title": "Action Time - Clock Divider Nbit", "created": "2021-08-31T15:30:31Z", "is_published": true, "asset": {"_class": "asset", "id": 36395932, "asset_type": "Video", "title": "08.23_Action_Time_Clock_Divider_Nbit.mp4", "created": "2021-09-23T10:13:47Z"}, "object_index": 151, "url": "/course/verilog-hdl-fundamentals-for-digital-design-and-verification/learn/lecture/28275278"}]}]};
    var correct = 0;
    var total = 0;
    const questionData = quizData.questions
    const passPercent = quizData.pass_percent
    function kiemTraDapAn(correctMuti, choise) {
      // Chuyển đổi các số trong choise thành chữ cái tương ứng
      const choiseLetters = choise.map(num => String.fromCharCode(parseInt(num) + 'a'.charCodeAt(0)));
      console.log('choiseLetters',choiseLetters)
      // Kiểm tra điều kiện:
      // 1. Chiều dài hai mảng phải bằng nhau
      // 2. Tất cả các phần tử trong choiseLetters phải có trong correctMuti
      if (
        choiseLetters.length === correctMuti.length &&
        choiseLetters.every(c => correctMuti.includes(c))
      ) {
        return true;
      } else {
        return false;
      }
    }
    function main() {
      total = questionData.length;

      var questions = [];
      for (var i = 0; i < questionData.length; i++) {
        var question = questionData[i];
        var questionText = question.prompt.question;
        var answers = question.prompt.answers;
        var correctAnswer = question.correct_response[0];
        var correctMuti = question.correct_response;
        var correctAnswerText = answers[correctAnswer.charCodeAt(0) - 97];
        var questionObj = {
          question: questionText,
          correctAnswer: correctAnswerText,
          answers: answers,
          id: question.id,
          explanation: question.prompt.explanation,
          correctMuti

        };
        questions.push(questionObj);
      }
      console.log(questions.filter(i => i.correctMuti.length > 1))

      updateScore();

      // display the questions
      var questionsContainer = document.getElementById("quiz-container");
      for (var i = 0; i < questions.length; i++) {
        var question = questions[i];
        var questionElement = document.createElement("form");
        questionElement.className = "question";
        questionElement.innerHTML =
          "<span>Question " +
          (i + 1) +
          ":</span>" +
          '<div class="question-prompt">' +
          question.question +
          "</div>";
        questionElement.id = question.id;
        questionElement.classList.add("quiz-container");
        var answersElement = document.createElement("ul");
        answersElement.className = "answers";
        console.log('question.correctMuti', question.correctMuti.length)
        if (question.correctMuti.length > 1) {
          for (var j = 0; j < question.answers.length; j++) {
            var answer = question.answers[j];
            var answerElement = document.createElement("li");
            answerElement.className = "answer";
            answerElement.innerHTML =
              '<label for="input-' +
              question.id +
              "-" +
              j +
              '"><div onclick="select2(' +
              question.id +
              ", " +
              j +
              ')"><input id="input-' +
              question.id +
              "-" +
              j +
              '" type="checkbox" name="question' +
              i +
              '" value="' +
              j +
              '">' +
              answer +
              "</input></div></label>";
            answerElement.classList.add("question-answer");
            answersElement.appendChild(answerElement);
          }
        } else {
          for (var j = 0; j < question.answers.length; j++) {
            var answer = question.answers[j];
            var answerElement = document.createElement("li");
            answerElement.className = "answer";
            answerElement.innerHTML =
              '<label for="input-' +
              question.id +
              "-" +
              j +
              '"><div onclick="select(' +
              question.id +
              ", " +
              j +
              ')"><span></span><input id="input-' +
              question.id +
              "-" +
              j +
              '" type="radio" name="question' +
              i +
              '" value="' +
              j +
              '">' +
              answer +
              "</input></div></label>";
            answerElement.classList.add("question-answer");
            answersElement.appendChild(answerElement);
          }
        }
        questionElement.appendChild(answersElement);

        // add a submit button
        var submitButton = document.createElement("button");
        submitButton.className = "submit";
        submitButton.innerHTML = "Submit";
        submitButton.classList.add("submit-button");

        submitButton.addEventListener("click", function (e) {
          e.preventDefault();
          var questionElement = e.target.parentElement;
          var questionId = questionElement.id;
          var question = questions.filter(function (q) {
            return q.id == questionId;
          })[0];

          // set the border color of all answers to black
          var answers = questionElement.getElementsByClassName("answer");
          for (var i = 0; i < answers.length; i++) {
            console.log(answers[i]);
            answers[i].children[0].style.borderColor = "#1c1d1f";
          }

          var answer = questionElement.querySelector(
            'input[type="radio"]:checked'
          );
          var mutilanswer = questionElement.querySelectorAll(
            'input[type="checkbox"]:checked'
          );
          if (answer) {
            var answerIndex = answer.value;
            var answerText = question.answers[answerIndex];
            if (answerText == question.correctAnswer) {
              answer.parentElement.parentElement.style.borderColor =
                "limegreen";
              // alert("Correct!");
              correct++;
              updateScore();
              questionElement.innerHTML += question.explanation

            } else {
              answer.parentElement.parentElement.style.borderColor = "red";
              // alert("Incorrect!");
            }
          }
          if (mutilanswer) {
            var answerIndex = [...mutilanswer].map(a => a.value);

            if (kiemTraDapAn(question.correctMuti, answerIndex)) {
              [...mutilanswer].map(item => {
                item.parentElement.parentElement.style.borderColor =
                "limegreen";
              })
              // alert("Correct!");
              correct++;
              updateScore();
              questionElement.innerHTML += question.explanation
            } else {
              [...mutilanswer].map(item => {
                item.parentElement.parentElement.style.borderColor =
                "red";
              })
            }
            // var answerText = question.answers[answerIndex];
            // if (answerText == question.correctAnswer) {
            //   answer.parentElement.parentElement.style.borderColor =
            //     "limegreen";
            //   // alert("Correct!");
            //   correct++;
            //   updateScore();
            //   questionElement.innerHTML += question.explanation

            // } else {
            //   answer.parentElement.parentElement.style.borderColor = "red";
            //   // alert("Incorrect!");
            // }
          }
          // else {
          //   alert("Please select an answer.");
          // }

        });

        // add button
        questionElement.appendChild(submitButton);

        questionsContainer.appendChild(questionElement);
      }
    }

    function select(question, answer) {
      var questionElement = document.getElementById(question);
      var answers = questionElement.getElementsByClassName("answer");
      for (var i = 0; i < answers.length; i++) {
        var span = answers[i].children[0].children[0].children[0];
        var input = answers[i].children[0].children[0].children[1];
        span.classList.remove("selected");
        input.checked = false;
      }
      var span = answers[answer].children[0].children[0].children[0];
      var input = answers[answer].children[0].children[0].children[1];
      span.classList.add("selected");
      input.checked = true;
    }
    function select2(question, answer) {
      var questionElement = document.getElementById(question);
      var answers = questionElement.getElementsByClassName("answer");
      // for (var i = 0; i < answers.length; i++) {
      //   var span = answers[i].children[0].children[0].children[0];
      //   var input = answers[i].children[0].children[0].children[1];
      //   if(input.checked){
      //     span.classList.remove("selected");
      //     input.checked = false;
      //   }

      // }
      // var span = answers[answer].children[0].children[0].children[0];
      // var input = answers[answer].children[0].children[0].children[1];
      // span.classList.add("selected");
      // input.checked = true;
    }
    function updateScore() {
      var scoreElem = document.getElementById("score");
      const score = (correct / total) * 100;
      scoreElem.innerHTML = "Score: " + score + "/" + passPercent + "%";
    }
  </script>
</body>

</html>